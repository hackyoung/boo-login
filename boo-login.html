<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../boo-position/boo-layer.html">
<link rel="import" href="../paper-progress/paper-progress.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="./boo-login-userid-form.html">
<link rel="import" href="./boo-login-password-form.html">

<dom-module id="boo-login">
  <template>
    <style>
      :host {
        display: block;
      }
      boo-layer {
        box-shadow: 1px 1px 7px rgba(0, 0, 0, .4);
        padding: 60px 40px 90px 40px;
        background-color: white;
        min-width: 350px;
        position: absolute;
        overflow-y: auto;
        overflow-x: hidden;
        z-index: 1;
        transition: .2s all ease-in-out;
        --boo-layer-progress: {
          --paper-progress-container-color: white;
          width: calc(100% + 80px);
          margin-top: -60px;
          margin-left: -40px;
        }
      }
      @media screen and (max-width: 679px) {
        boo-layer {
          width: calc(100vw - 20px);
          height: calc(100vh - 150px);
          min-width: 300px;
          padding-left: 10px;
          padding-right: 10px;
          --boo-layer-progress: {
            --paper-progress-container-color: white;
            margin-left: -10px;
            margin-top: -60px;
            width: calc(100% + 20px);
          }
        }
        header {
          margin-top: 40%;
        }
      }
    </style>
    <boo-layer id="layer" opened>
      <boo-login-userid-form 
        shown
        loading={{loading}}    
        id="userid-form" 
        on-submit="_userIdComplete" 
        on-after-hidden="_userIdHidden">
      </boo-login-userid-form>
      <boo-login-password-form 
        style="display: none" 
        on-after-shown="_passwordShown"
        id="password-form"></boo-login-password-form>
    </boo-layer>
  </template>

  <script>
    /**
     * `boo-login`
     * a polymer login element
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class BooLogin extends Polymer.Element {
      static get is() { return 'boo-login'; }
      static get properties() {
        return {
          loading: {
            type: Boolean,
            value: false,
            observer: '_loadingChanged',
            notify: true
          }
        };
      }
      _userIdComplete(e) {
        this.loading = true; 
        e.target.shown = false;
      }
      _userIdHidden(e) {
        let pass = this.shadowRoot.querySelector("#password-form");
        pass.shown = true;
      }

      _passwordShown(e) {
        let layer = this.shadowRoot.querySelector("#layer");
        layer.update();
        this.$.layer.progress = false;
      }

      _loadingChanged (loading) {
        if (loading) {
          this.$.layer.progress = true;
        }
      }
    }

    window.customElements.define(BooLogin.is, BooLogin);
  </script>
</dom-module>
